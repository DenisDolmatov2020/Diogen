# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–∫—Å–∏ –≤ Diogen Chat Widget

## –ü—Ä–æ–±–ª–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã:

### 1. ‚ùå –û—à–∏–±–∫–∞ 404 –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
**–ë—ã–ª–æ:** –í–∏–¥–∂–µ—Ç –ø—ã—Ç–∞–ª—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `/api/proxy` –Ω–∞ Surge.sh/Netlify, –≥–¥–µ —ç—Ç–æ–≥–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
**–°—Ç–∞–ª–æ:** –ü—Ä–æ–∫—Å–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ localhost, –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ - –ø—Ä—è–º—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ API

### 2. ‚ùå –°–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø—Ä–æ–∫—Å–∏
**–ë—ã–ª–æ:** –ó–∞–ø—É—Ç–∞–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ø–æ—Ä—Ç–æ–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ –≤–Ω–µ—à–Ω–∏—Ö CORS –ø—Ä–æ–∫—Å–∏
**–°—Ç–∞–ª–æ:** –ü—Ä–æ—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞ - –ø—Ä–æ–∫—Å–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è localhost

### 3. ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏
**–ë—ã–ª–æ:** –°–º–µ—à–∞–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å `isLocalhost` –∏ —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏
**–°—Ç–∞–ª–æ:** –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ - `X-TOKEN` –¥–ª—è –ø—Ä–æ–∫—Å–∏, `Authorization` –¥–ª—è –ø—Ä—è–º—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

### 4. ‚ùå –ù–µ—Ç–æ—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
**–ë—ã–ª–æ:** –ù–µ—Ç–æ—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö CORS
**–°—Ç–∞–ª–æ:** –ü–æ–Ω—è—Ç–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ CORS –Ω–∞ –±—ç–∫–µ–Ω–¥–µ

## –û—Å–Ω–æ–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:

### `shouldUseProxy()` - —É–ø—Ä–æ—â–µ–Ω–∞ –ª–æ–≥–∏–∫–∞
```javascript
shouldUseProxy() {
    const isLocalhost = window.location.hostname === 'localhost';
    console.log(`[Diogen] Hostname: ${window.location.hostname}, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ–∫—Å–∏: ${isLocalhost}`);
    return isLocalhost;
}
```

### `generateProxyUrl()` - –≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–π –ø—Ä–æ–∫—Å–∏
```javascript
generateProxyUrl() {
    return '/api/proxy';
}
```

### `callChatAPI()` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∑–∞–≥–æ–ª–æ–≤–∫–∏
- **–î–ª—è –ø—Ä–æ–∫—Å–∏ (localhost):** `X-Target-URL` –∏ `X-TOKEN`
- **–î–ª—è –ø—Ä—è–º—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (production):** `Authorization`

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ CORS
- **localhost:** –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ Vite –ø—Ä–æ–∫—Å–∏
- **production:** –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ CORS –Ω–∞ –±—ç–∫–µ–Ω–¥–µ

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **Localhost (—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞):** 
   - ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Vite –ø—Ä–æ–∫—Å–∏ `/api/proxy`
   - ‚úÖ –ó–∞–≥–æ–ª–æ–≤–∫–∏: `X-Target-URL` –∏ `X-TOKEN`

2. **Production (Surge.sh/Netlify):**
   - ‚úÖ –ü—Ä—è–º—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ API `https://knowledge.slovo-soft.ru/api/v1/mentorium`
   - ‚úÖ –ó–∞–≥–æ–ª–æ–≤–æ–∫: `Authorization: Basic ...`
   - ‚ö†Ô∏è **–¢—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ CORS –Ω–∞ –±—ç–∫–µ–Ω–¥–µ!**

## –§–∞–π–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –∏–∑–º–µ–Ω–µ–Ω—ã:

- ‚úÖ `widget/diogen-chat-widget.js` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–∫—Å–∏
- ‚úÖ `netlify/functions/proxy.js` - —É–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ Basic Auth
- ‚úÖ `widget/test-improved-proxy.html` - —Ç–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
- ‚úÖ `widget/CORS-–ù–ê–°–¢–†–û–ô–ö–ê-–ë–≠–ö–ï–ù–î.md` - –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –±—ç–∫–µ–Ω–¥–∞

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

–û—Ç–∫—Ä–æ–π—Ç–µ `widget/test-improved-proxy.html` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:
- ‚úÖ –õ–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø—Ä–æ–∫—Å–∏
- ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä—è–º–æ–≥–æ API
- ‚ö†Ô∏è –ü—Ä–æ–≤–µ—Ä–∫–∞ CORS –Ω–∞—Å—Ç—Ä–æ–µ–∫

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

### –î–ª—è –∫–æ–º–∞–Ω–¥—ã –±—ç–∫–µ–Ω–¥–∞:
1. üìã –ò–∑—É—á–∏—Ç—å `widget/CORS-–ù–ê–°–¢–†–û–ô–ö–ê-–ë–≠–ö–ï–ù–î.md`
2. üîß –ù–∞—Å—Ç—Ä–æ–∏—Ç—å CORS –∑–∞–≥–æ–ª–æ–≤–∫–∏ –Ω–∞ `https://knowledge.slovo-soft.ru/api/v1/mentorium`
3. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å –ø–æ–º–æ—â—å—é curl –∏–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞

### –î–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞:
1. ‚úÖ –í–∏–¥–∂–µ—Ç –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ
2. üöÄ –ú–æ–∂–Ω–æ –¥–µ–ø–ª–æ–∏—Ç—å –Ω–∞ –ª—é–±–æ–π —Ö–æ—Å—Ç–∏–Ω–≥
3. üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –æ—à–∏–±–∫–∏ CORS –≤ –∫–æ–Ω—Å–æ–ª–∏

## –†–µ–∑—É–ª—å—Ç–∞—Ç:

- üéØ –ü—Ä–æ—Å—Ç–∞—è –∏ –ø–æ–Ω—è—Ç–Ω–∞—è –ª–æ–≥–∏–∫–∞
- üîí –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- üöÄ –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ª—é–±–æ–º —Ö–æ—Å—Ç–∏–Ω–≥–µ
- üìù –ß–µ—Ç–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ CORS
- ‚ùå –ë–æ–ª—å—à–µ –Ω–∏–∫–∞–∫–∏—Ö –æ—à–∏–±–æ–∫ 404 —Å –ø—Ä–æ–∫—Å–∏! 