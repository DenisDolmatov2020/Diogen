# Изменения в API чат-бота

## Обзор изменений

Чат-бот был обновлен для работы с новым форматом API в соответствии с требованиями тех лида.

## Формат запроса

Теперь фронтенд отправляет запросы в следующем формате:

```json
[
    {
        "component_name": "meta_data",
        "parent_block_id": "block-0-1",
        "action_mode": "dialog",
        "action_params": [
            {
                "variable": "input_text",
                "data": "Текст сообщения пользователя"
            },
            {
                "variable": "keys",
                "data": ["button_variable_001"]
            },
            {
                "variable": "reference_id",
                "data": "000.1234567890.1741177241t"
            }
        ]
    }
]
```

### Параметры запроса:

- **input_text**: Текст, введенный пользователем или заголовок нажатой кнопки
- **keys**: Массив идентификаторов кнопок (если пользователь нажал на кнопку действия)
- **reference_id**: Уникальный идентификатор сессии (генерируется автоматически)

## Формат ответа сервера

Сервер должен возвращать массив компонентов:

```json
[
    {
        "component_name": "text_block",
        "parent_block_id": "block-0-0",
        "component_id": "txt-0-0-0",
        "items": [
            {
                "title": "Заголовок ответа",
                "data": "Текст ответа бота",
                "status": "nice"
            }
        ]
    },
    {
        "component_name": "picture_block",
        "parent_block_id": "block-0-0",
        "component_id": "pict-0-0-1",
        "items": [
            {
                "title": "Название изображения",
                "status": "nice",
                "data": {
                    "src": "https://example.com/image.jpg",
                    "alt": "Описание изображения",
                    "width": 800,
                    "height": 600
                }
            }
        ]
    },
    {
        "component_name": "action_button",
        "parent_block_id": "block-0-0",
        "component_id": "btn-0-0-2",
        "items": [
            {
                "title": "Текст кнопки",
                "status": "normal",
                "variable": "unique_button_id_001"
            }
        ]
    }
]
```

### Типы компонентов:

1. **text_block**: Текстовые блоки с ответами бота
2. **picture_block**: Изображения с подписями
3. **action_button**: Кнопки для быстрых действий

## Мок-данные для разработки

В режиме разработки используются мок-данные из файла `src/api/chatMockResponses.json`.

Система умно выбирает ответ на основе:
- Переменных кнопок (параметр `keys`)
- Ключевых слов в тексте сообщения
- Случайного выбора для разнообразия

## Файлы, которые были изменены:

1. **src/api/apiService.ts** - Обновлен метод `sendChatMessage()`
2. **src/components/ChatPage.vue** - Добавлена поддержка новых компонентов
3. **src/api/chatMockResponses.json** - Мок-данные для тестирования
4. **src/api/testChatRequest.ts** - Примеры запросов и ответов

## Тестирование

Для тестирования можно:
1. Вводить различные сообщения в чат
2. Нажимать на кнопки действий
3. Проверять отображение изображений и текстовых блоков

Система автоматически выберет подходящий мок-ответ на основе содержимого сообщения.

## Готовность к интеграции

Фронтенд готов к работе с реальным API. Когда сервер будет готов обрабатывать новый формат запросов, нужно будет только отключить режим разработки (`env.devMode = false`).